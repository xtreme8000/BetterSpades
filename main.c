#ifdef _WIN32
#define OS_WINDOWS
#endif

#ifdef __linux__
#define OS_LINUX
#endif

#ifdef DEVICE_RASPBERRYPI
#define OS_LINUX
#endif

#ifdef OS_WINDOWS
#include <windows.h>
#endif

#include <GL/gl.h>
#include <GL/glu.h>
#include <GL/freeglut.h>

#include <stdlib.h>
#include <string.h>
#include <math.h>
#include <float.h>
#include <stdio.h>
#include <time.h>
#include "GL/glext.h"

#define CHUNK_SIZE 16
#define CHUNKS_PER_DIM 32
typedef unsigned char boolean;
#define true 1
#define false 0

int timems() {
	return clock()/(CLOCKS_PER_SEC / 1000);
}

#include "chunk.h"
#include "map.h"
#include "model.h"
#include "file.h"
#include "camera.h"
#include "aabb.h"
#include "particle.h"
#include "ogl.h"

struct RENDER_OPTIONS {
	boolean opengl14 ;
	boolean color_correction;
	boolean shadow_entities ;
	boolean ambient_occlusion;
	float render_distance;
	int window_width;
	int window_height;
	unsigned char multisamples;
} settings = {0};

int last_mouse_x = 0, last_mouse_y = 0;
int uniform_point_size = 0, uniform_near_plane_height = 0, uniform_camera_x = 0, uniform_camera_z = 0, uniform_fog_distance = 0, uniform_map_size_x = 0, uniform_map_size_z = 0, uniform_fog_color = 0, uniform_setting_color_correction = 0, uniform_draw_ui = 0;
unsigned char key_map[256] = {0};
unsigned char draw_outline = 0;

PFNGLPOINTPARAMETERFVPROC glPointParameterfv = 0;
PFNGLPOINTPARAMETERFPROC glPointParameterf = 0;
PFNGLCREATESHADERPROC glCreateShader = 0;
PFNGLSHADERSOURCEPROC glShaderSource = 0;
PFNGLCOMPILESHADERPROC glCompileShader = 0;
PFNGLCREATEPROGRAMPROC glCreateProgram = 0;
PFNGLATTACHSHADERPROC glAttachShader = 0;
PFNGLLINKPROGRAMPROC glLinkProgram = 0;
PFNGLUSEPROGRAMPROC glUseProgram = 0;
PFNGLGETUNIFORMLOCATIONPROC glGetUniformLocation = 0;
PFNGLUNIFORM1FPROC glUniform1f = 0;
PFNGLUNIFORM4FPROC glUniform4f = 0;
PFNGLUNIFORM1IPROC glUniform1i = 0;
PFNGLTEXIMAGE3DPROC glTexImage3D = 0;

void init();
void display();
void reshape(int w, int h);

#include "map.c"
#include "chunk.c"
#include "classicgen.c"
#include "model.c"
#include "file.c"
#include "camera.c"
#include "aabb.c"
#include "particle.c"
#include "ogl.c"

unsigned char color_correction[] = {16,23,36,20,23,36,36,23,36,59,23,36,90,23,36,138,23,36,174,23,36,199,23,36,212,23,36,221,23,36,228,23,36,233,23,36,238,23,36,239,23,36,243,23,36,246,23,36,16,23,36,20,23,36,36,23,36,59,23,36,90,23,36,138,23,36,174,23,36,199,23,36,212,23,36,221,23,36,228,23,36,233,23,36,238,23,36,239,23,36,243,23,36,246,23,36,16,36,36,20,36,36,36,36,36,59,36,36,90,36,36,138,36,36,174,36,36,199,36,36,212,36,36,221,36,36,228,36,36,233,36,36,238,36,36,239,36,36,243,36,36,246,36,36,16,50,36,20,50,36,36,50,36,59,50,36,90,50,36,138,50,36,174,50,36,199,50,36,212,50,36,221,50,36,228,50,36,233,50,36,238,50,36,239,50,36,243,50,36,246,50,36,16,68,36,20,68,36,36,68,36,59,68,36,90,68,36,138,68,36,174,68,36,199,68,36,212,68,36,221,68,36,228,68,36,233,68,36,238,68,36,239,68,36,243,68,36,246,68,36,16,93,36,20,93,36,36,93,36,59,93,36,90,93,36,138,93,36,174,93,36,199,93,36,212,93,36,221,93,36,228,93,36,233,93,36,238,93,36,239,93,36,243,93,36,246,93,36,16,127,36,20,127,36,36,127,36,59,127,36,90,127,36,138,127,36,174,127,36,199,127,36,212,127,36,221,127,36,228,127,36,233,127,36,238,127,36,239,127,36,243,127,36,246,127,36,16,166,36,20,166,36,36,166,36,59,166,36,90,166,36,138,166,36,174,166,36,199,166,36,212,166,36,221,166,36,228,166,36,233,166,36,238,166,36,239,166,36,243,166,36,246,166,36,16,194,36,20,194,36,36,194,36,59,194,36,90,194,36,138,194,36,174,194,36,199,194,36,212,194,36,221,194,36,228,194,36,233,194,36,238,194,36,239,194,36,243,194,36,246,194,36,16,213,36,20,213,36,36,213,36,59,213,36,90,213,36,138,213,36,174,213,36,199,213,36,212,213,36,221,213,36,228,213,36,233,213,36,238,213,36,239,213,36,243,213,36,246,213,36,16,223,36,20,223,36,36,223,36,59,223,36,90,223,36,138,223,36,174,223,36,199,223,36,212,223,36,221,223,36,228,223,36,233,223,36,238,223,36,239,223,36,243,223,36,246,223,36,16,230,36,20,230,36,36,230,36,59,230,36,90,230,36,138,230,36,174,230,36,199,230,36,212,230,36,221,230,36,228,230,36,233,230,36,238,230,36,239,230,36,243,230,36,246,230,36,16,236,36,20,236,36,36,236,36,59,236,36,90,236,36,138,236,36,174,236,36,199,236,36,212,236,36,221,236,36,228,236,36,233,236,36,238,236,36,239,236,36,243,236,36,246,236,36,16,240,36,20,240,36,36,240,36,59,240,36,90,240,36,138,240,36,174,240,36,199,240,36,212,240,36,221,240,36,228,240,36,233,240,36,238,240,36,239,240,36,243,240,36,246,240,36,16,243,36,20,243,36,36,243,36,59,243,36,90,243,36,138,243,36,174,243,36,199,243,36,212,243,36,221,243,36,228,243,36,233,243,36,238,243,36,239,243,36,243,243,36,246,243,36,16,246,36,20,246,36,36,246,36,59,246,36,90,246,36,138,246,36,174,246,36,199,246,36,212,246,36,221,246,36,228,246,36,233,246,36,238,246,36,239,246,36,243,246,36,246,246,36,
									16,23,36,20,23,36,36,23,36,59,23,36,90,23,36,138,23,36,174,23,36,199,23,36,212,23,36,221,23,36,228,23,36,233,23,36,238,23,36,239,23,36,243,23,36,246,23,36,16,23,36,20,23,36,36,23,36,59,23,36,90,23,36,138,23,36,174,23,36,199,23,36,212,23,36,221,23,36,228,23,36,233,23,36,238,23,36,239,23,36,243,23,36,246,23,36,16,36,36,20,36,36,36,36,36,59,36,36,90,36,36,138,36,36,174,36,36,199,36,36,212,36,36,221,36,36,228,36,36,233,36,36,238,36,36,239,36,36,243,36,36,246,36,36,16,50,36,20,50,36,36,50,36,59,50,36,90,50,36,138,50,36,174,50,36,199,50,36,212,50,36,221,50,36,228,50,36,233,50,36,238,50,36,239,50,36,243,50,36,246,50,36,16,68,36,20,68,36,36,68,36,59,68,36,90,68,36,138,68,36,174,68,36,199,68,36,212,68,36,221,68,36,228,68,36,233,68,36,238,68,36,239,68,36,243,68,36,246,68,36,16,93,36,20,93,36,36,93,36,59,93,36,90,93,36,138,93,36,174,93,36,199,93,36,212,93,36,221,93,36,228,93,36,233,93,36,238,93,36,239,93,36,243,93,36,246,93,36,16,127,36,20,127,36,36,127,36,59,127,36,90,127,36,138,127,36,174,127,36,199,127,36,212,127,36,221,127,36,228,127,36,233,127,36,238,127,36,239,127,36,243,127,36,246,127,36,16,166,36,20,166,36,36,166,36,59,166,36,90,166,36,138,166,36,174,166,36,199,166,36,212,166,36,221,166,36,228,166,36,233,166,36,238,166,36,239,166,36,243,166,36,246,166,36,16,194,36,20,194,36,36,194,36,59,194,36,90,194,36,138,194,36,174,194,36,199,194,36,212,194,36,221,194,36,228,194,36,233,194,36,238,194,36,239,194,36,243,194,36,246,194,36,16,213,36,20,213,36,36,213,36,59,213,36,90,213,36,138,213,36,174,213,36,199,213,36,212,213,36,221,213,36,228,213,36,233,213,36,238,213,36,239,213,36,243,213,36,246,213,36,16,223,36,20,223,36,36,223,36,59,223,36,90,223,36,138,223,36,174,223,36,199,223,36,212,223,36,221,223,36,228,223,36,233,223,36,238,223,36,239,223,36,243,223,36,246,223,36,16,230,36,20,230,36,36,230,36,59,230,36,90,230,36,138,230,36,174,230,36,199,230,36,212,230,36,221,230,36,228,230,36,233,230,36,238,230,36,239,230,36,243,230,36,246,230,36,16,236,36,20,236,36,36,236,36,59,236,36,90,236,36,138,236,36,174,236,36,199,236,36,212,236,36,221,236,36,228,236,36,233,236,36,238,236,36,239,236,36,243,236,36,246,236,36,16,240,36,20,240,36,36,240,36,59,240,36,90,240,36,138,240,36,174,240,36,199,240,36,212,240,36,221,240,36,228,240,36,233,240,36,238,240,36,239,240,36,243,240,36,246,240,36,16,243,36,20,243,36,36,243,36,59,243,36,90,243,36,138,243,36,174,243,36,199,243,36,212,243,36,221,243,36,228,243,36,233,243,36,238,243,36,239,243,36,243,243,36,246,243,36,16,246,36,20,246,36,36,246,36,59,246,36,90,246,36,138,246,36,174,246,36,199,246,36,212,246,36,221,246,36,228,246,36,233,246,36,238,246,36,239,246,36,243,246,36,246,246,36,
									16,23,43,20,23,43,36,23,43,59,23,43,90,23,43,138,23,43,174,23,43,199,23,43,212,23,43,221,23,43,228,23,43,233,23,43,238,23,43,239,23,43,243,23,43,246,23,43,16,23,43,20,23,43,36,23,43,59,23,43,90,23,43,138,23,43,174,23,43,199,23,43,212,23,43,221,23,43,228,23,43,233,23,43,238,23,43,239,23,43,243,23,43,246,23,43,16,36,43,20,36,43,36,36,43,59,36,43,90,36,43,138,36,43,174,36,43,199,36,43,212,36,43,221,36,43,228,36,43,233,36,43,238,36,43,239,36,43,243,36,43,246,36,43,16,50,43,20,50,43,36,50,43,59,50,43,90,50,43,138,50,43,174,50,43,199,50,43,212,50,43,221,50,43,228,50,43,233,50,43,238,50,43,239,50,43,243,50,43,246,50,43,16,68,43,20,68,43,36,68,43,59,68,43,90,68,43,138,68,43,174,68,43,199,68,43,212,68,43,221,68,43,228,68,43,233,68,43,238,68,43,239,68,43,243,68,43,246,68,43,16,93,43,20,93,43,36,93,43,59,93,43,90,93,43,138,93,43,174,93,43,199,93,43,212,93,43,221,93,43,228,93,43,233,93,43,238,93,43,239,93,43,243,93,43,246,93,43,16,127,43,20,127,43,36,127,43,59,127,43,90,127,43,138,127,43,174,127,43,199,127,43,212,127,43,221,127,43,228,127,43,233,127,43,238,127,43,239,127,43,243,127,43,246,127,43,16,166,43,20,166,43,36,166,43,59,166,43,90,166,43,138,166,43,174,166,43,199,166,43,212,166,43,221,166,43,228,166,43,233,166,43,238,166,43,239,166,43,243,166,43,246,166,43,16,194,43,20,194,43,36,194,43,59,194,43,90,194,43,138,194,43,174,194,43,199,194,43,212,194,43,221,194,43,228,194,43,233,194,43,238,194,43,239,194,43,243,194,43,246,194,43,16,213,43,20,213,43,36,213,43,59,213,43,90,213,43,138,213,43,174,213,43,199,213,43,212,213,43,221,213,43,228,213,43,233,213,43,238,213,43,239,213,43,243,213,43,246,213,43,16,223,43,20,223,43,36,223,43,59,223,43,90,223,43,138,223,43,174,223,43,199,223,43,212,223,43,221,223,43,228,223,43,233,223,43,238,223,43,239,223,43,243,223,43,246,223,43,16,230,43,20,230,43,36,230,43,59,230,43,90,230,43,138,230,43,174,230,43,199,230,43,212,230,43,221,230,43,228,230,43,233,230,43,238,230,43,239,230,43,243,230,43,246,230,43,16,236,43,20,236,43,36,236,43,59,236,43,90,236,43,138,236,43,174,236,43,199,236,43,212,236,43,221,236,43,228,236,43,233,236,43,238,236,43,239,236,43,243,236,43,246,236,43,16,240,43,20,240,43,36,240,43,59,240,43,90,240,43,138,240,43,174,240,43,199,240,43,212,240,43,221,240,43,228,240,43,233,240,43,238,240,43,239,240,43,243,240,43,246,240,43,16,243,43,20,243,43,36,243,43,59,243,43,90,243,43,138,243,43,174,243,43,199,243,43,212,243,43,221,243,43,228,243,43,233,243,43,238,243,43,239,243,43,243,243,43,246,243,43,16,246,43,20,246,43,36,246,43,59,246,43,90,246,43,138,246,43,174,246,43,199,246,43,212,246,43,221,246,43,228,246,43,233,246,43,238,246,43,239,246,43,243,246,43,246,246,43,
									16,23,55,20,23,55,36,23,55,59,23,55,90,23,55,138,23,55,174,23,55,199,23,55,212,23,55,221,23,55,228,23,55,233,23,55,238,23,55,239,23,55,243,23,55,246,23,55,16,23,55,20,23,55,36,23,55,59,23,55,90,23,55,138,23,55,174,23,55,199,23,55,212,23,55,221,23,55,228,23,55,233,23,55,238,23,55,239,23,55,243,23,55,246,23,55,16,36,55,20,36,55,36,36,55,59,36,55,90,36,55,138,36,55,174,36,55,199,36,55,212,36,55,221,36,55,228,36,55,233,36,55,238,36,55,239,36,55,243,36,55,246,36,55,16,50,55,20,50,55,36,50,55,59,50,55,90,50,55,138,50,55,174,50,55,199,50,55,212,50,55,221,50,55,228,50,55,233,50,55,238,50,55,239,50,55,243,50,55,246,50,55,16,68,55,20,68,55,36,68,55,59,68,55,90,68,55,138,68,55,174,68,55,199,68,55,212,68,55,221,68,55,228,68,55,233,68,55,238,68,55,239,68,55,243,68,55,246,68,55,16,93,55,20,93,55,36,93,55,59,93,55,90,93,55,138,93,55,174,93,55,199,93,55,212,93,55,221,93,55,228,93,55,233,93,55,238,93,55,239,93,55,243,93,55,246,93,55,16,127,55,20,127,55,36,127,55,59,127,55,90,127,55,138,127,55,174,127,55,199,127,55,212,127,55,221,127,55,228,127,55,233,127,55,238,127,55,239,127,55,243,127,55,246,127,55,16,166,55,20,166,55,36,166,55,59,166,55,90,166,55,138,166,55,174,166,55,199,166,55,212,166,55,221,166,55,228,166,55,233,166,55,238,166,55,239,166,55,243,166,55,246,166,55,16,194,55,20,194,55,36,194,55,59,194,55,90,194,55,138,194,55,174,194,55,199,194,55,212,194,55,221,194,55,228,194,55,233,194,55,238,194,55,239,194,55,243,194,55,246,194,55,16,213,55,20,213,55,36,213,55,59,213,55,90,213,55,138,213,55,174,213,55,199,213,55,212,213,55,221,213,55,228,213,55,233,213,55,238,213,55,239,213,55,243,213,55,246,213,55,16,223,55,20,223,55,36,223,55,59,223,55,90,223,55,138,223,55,174,223,55,199,223,55,212,223,55,221,223,55,228,223,55,233,223,55,238,223,55,239,223,55,243,223,55,246,223,55,16,230,55,20,230,55,36,230,55,59,230,55,90,230,55,138,230,55,174,230,55,199,230,55,212,230,55,221,230,55,228,230,55,233,230,55,238,230,55,239,230,55,243,230,55,246,230,55,16,236,55,20,236,55,36,236,55,59,236,55,90,236,55,138,236,55,174,236,55,199,236,55,212,236,55,221,236,55,228,236,55,233,236,55,238,236,55,239,236,55,243,236,55,246,236,55,16,240,55,20,240,55,36,240,55,59,240,55,90,240,55,138,240,55,174,240,55,199,240,55,212,240,55,221,240,55,228,240,55,233,240,55,238,240,55,239,240,55,243,240,55,246,240,55,16,243,55,20,243,55,36,243,55,59,243,55,90,243,55,138,243,55,174,243,55,199,243,55,212,243,55,221,243,55,228,243,55,233,243,55,238,243,55,239,243,55,243,243,55,246,243,55,16,246,55,20,246,55,36,246,55,59,246,55,90,246,55,138,246,55,174,246,55,199,246,55,212,246,55,221,246,55,228,246,55,233,246,55,238,246,55,239,246,55,243,246,55,246,246,55,
									16,23,68,20,23,68,36,23,68,59,23,68,90,23,68,138,23,68,174,23,68,199,23,68,212,23,68,221,23,68,228,23,68,233,23,68,238,23,68,239,23,68,243,23,68,246,23,68,16,23,68,20,23,68,36,23,68,59,23,68,90,23,68,138,23,68,174,23,68,199,23,68,212,23,68,221,23,68,228,23,68,233,23,68,238,23,68,239,23,68,243,23,68,246,23,68,16,36,68,20,36,68,36,36,68,59,36,68,90,36,68,138,36,68,174,36,68,199,36,68,212,36,68,221,36,68,228,36,68,233,36,68,238,36,68,239,36,68,243,36,68,246,36,68,16,50,68,20,50,68,36,50,68,59,50,68,90,50,68,138,50,68,174,50,68,199,50,68,212,50,68,221,50,68,228,50,68,233,50,68,238,50,68,239,50,68,243,50,68,246,50,68,16,68,68,20,68,68,36,68,68,59,68,68,90,68,68,138,68,68,174,68,68,199,68,68,212,68,68,221,68,68,228,68,68,233,68,68,238,68,68,239,68,68,243,68,68,246,68,68,16,93,68,20,93,68,36,93,68,59,93,68,90,93,68,138,93,68,174,93,68,199,93,68,212,93,68,221,93,68,228,93,68,233,93,68,238,93,68,239,93,68,243,93,68,246,93,68,16,127,68,20,127,68,36,127,68,59,127,68,90,127,68,138,127,68,174,127,68,199,127,68,212,127,68,221,127,68,228,127,68,233,127,68,238,127,68,239,127,68,243,127,68,246,127,68,16,166,68,20,166,68,36,166,68,59,166,68,90,166,68,138,166,68,174,166,68,199,166,68,212,166,68,221,166,68,228,166,68,233,166,68,238,166,68,239,166,68,243,166,68,246,166,68,16,194,68,20,194,68,36,194,68,59,194,68,90,194,68,138,194,68,174,194,68,199,194,68,212,194,68,221,194,68,228,194,68,233,194,68,238,194,68,239,194,68,243,194,68,246,194,68,16,213,68,20,213,68,36,213,68,59,213,68,90,213,68,138,213,68,174,213,68,199,213,68,212,213,68,221,213,68,228,213,68,233,213,68,238,213,68,239,213,68,243,213,68,246,213,68,16,223,68,20,223,68,36,223,68,59,223,68,90,223,68,138,223,68,174,223,68,199,223,68,212,223,68,221,223,68,228,223,68,233,223,68,238,223,68,239,223,68,243,223,68,246,223,68,16,230,68,20,230,68,36,230,68,59,230,68,90,230,68,138,230,68,174,230,68,199,230,68,212,230,68,221,230,68,228,230,68,233,230,68,238,230,68,239,230,68,243,230,68,246,230,68,16,236,68,20,236,68,36,236,68,59,236,68,90,236,68,138,236,68,174,236,68,199,236,68,212,236,68,221,236,68,228,236,68,233,236,68,238,236,68,239,236,68,243,236,68,246,236,68,16,240,68,20,240,68,36,240,68,59,240,68,90,240,68,138,240,68,174,240,68,199,240,68,212,240,68,221,240,68,228,240,68,233,240,68,238,240,68,239,240,68,243,240,68,246,240,68,16,243,68,20,243,68,36,243,68,59,243,68,90,243,68,138,243,68,174,243,68,199,243,68,212,243,68,221,243,68,228,243,68,233,243,68,238,243,68,239,243,68,243,243,68,246,243,68,16,246,68,20,246,68,36,246,68,59,246,68,90,246,68,138,246,68,174,246,68,199,246,68,212,246,68,221,246,68,228,246,68,233,246,68,238,246,68,239,246,68,243,246,68,246,246,68,
									16,23,84,20,23,84,36,23,84,59,23,84,90,23,84,138,23,84,174,23,84,199,23,84,212,23,84,221,23,84,228,23,84,233,23,84,238,23,84,239,23,84,243,23,84,246,23,84,16,23,84,20,23,84,36,23,84,59,23,84,90,23,84,138,23,84,174,23,84,199,23,84,212,23,84,221,23,84,228,23,84,233,23,84,238,23,84,239,23,84,243,23,84,246,23,84,16,36,84,20,36,84,36,36,84,59,36,84,90,36,84,138,36,84,174,36,84,199,36,84,212,36,84,221,36,84,228,36,84,233,36,84,238,36,84,239,36,84,243,36,84,246,36,84,16,50,84,20,50,84,36,50,84,59,50,84,90,50,84,138,50,84,174,50,84,199,50,84,212,50,84,221,50,84,228,50,84,233,50,84,238,50,84,239,50,84,243,50,84,246,50,84,16,68,84,20,68,84,36,68,84,59,68,84,90,68,84,138,68,84,174,68,84,199,68,84,212,68,84,221,68,84,228,68,84,233,68,84,238,68,84,239,68,84,243,68,84,246,68,84,16,93,84,20,93,84,36,93,84,59,93,84,90,93,84,138,93,84,174,93,84,199,93,84,212,93,84,221,93,84,228,93,84,233,93,84,238,93,84,239,93,84,243,93,84,246,93,84,16,127,84,20,127,84,36,127,84,59,127,84,90,127,84,138,127,84,174,127,84,199,127,84,212,127,84,221,127,84,228,127,84,233,127,84,238,127,84,239,127,84,243,127,84,246,127,84,16,166,84,20,166,84,36,166,84,59,166,84,90,166,84,138,166,84,174,166,84,199,166,84,212,166,84,221,166,84,228,166,84,233,166,84,238,166,84,239,166,84,243,166,84,246,166,84,16,194,84,20,194,84,36,194,84,59,194,84,90,194,84,138,194,84,174,194,84,199,194,84,212,194,84,221,194,84,228,194,84,233,194,84,238,194,84,239,194,84,243,194,84,246,194,84,16,213,84,20,213,84,36,213,84,59,213,84,90,213,84,138,213,84,174,213,84,199,213,84,212,213,84,221,213,84,228,213,84,233,213,84,238,213,84,239,213,84,243,213,84,246,213,84,16,223,84,20,223,84,36,223,84,59,223,84,90,223,84,138,223,84,174,223,84,199,223,84,212,223,84,221,223,84,228,223,84,233,223,84,238,223,84,239,223,84,243,223,84,246,223,84,16,230,84,20,230,84,36,230,84,59,230,84,90,230,84,138,230,84,174,230,84,199,230,84,212,230,84,221,230,84,228,230,84,233,230,84,238,230,84,239,230,84,243,230,84,246,230,84,16,236,84,20,236,84,36,236,84,59,236,84,90,236,84,138,236,84,174,236,84,199,236,84,212,236,84,221,236,84,228,236,84,233,236,84,238,236,84,239,236,84,243,236,84,246,236,84,16,240,84,20,240,84,36,240,84,59,240,84,90,240,84,138,240,84,174,240,84,199,240,84,212,240,84,221,240,84,228,240,84,233,240,84,238,240,84,239,240,84,243,240,84,246,240,84,16,243,84,20,243,84,36,243,84,59,243,84,90,243,84,138,243,84,174,243,84,199,243,84,212,243,84,221,243,84,228,243,84,233,243,84,238,243,84,239,243,84,243,243,84,246,243,84,16,246,84,20,246,84,36,246,84,59,246,84,90,246,84,138,246,84,174,246,84,199,246,84,212,246,84,221,246,84,228,246,84,233,246,84,238,246,84,239,246,84,243,246,84,246,246,84,
									16,23,106,20,23,106,36,23,106,59,23,106,90,23,106,138,23,106,174,23,106,199,23,106,212,23,106,221,23,106,228,23,106,233,23,106,238,23,106,239,23,106,243,23,106,246,23,106,16,23,106,20,23,106,36,23,106,59,23,106,90,23,106,138,23,106,174,23,106,199,23,106,212,23,106,221,23,106,228,23,106,233,23,106,238,23,106,239,23,106,243,23,106,246,23,106,16,36,106,20,36,106,36,36,106,59,36,106,90,36,106,138,36,106,174,36,106,199,36,106,212,36,106,221,36,106,228,36,106,233,36,106,238,36,106,239,36,106,243,36,106,246,36,106,16,50,106,20,50,106,36,50,106,59,50,106,90,50,106,138,50,106,174,50,106,199,50,106,212,50,106,221,50,106,228,50,106,233,50,106,238,50,106,239,50,106,243,50,106,246,50,106,16,68,106,20,68,106,36,68,106,59,68,106,90,68,106,138,68,106,174,68,106,199,68,106,212,68,106,221,68,106,228,68,106,233,68,106,238,68,106,239,68,106,243,68,106,246,68,106,16,93,106,20,93,106,36,93,106,59,93,106,90,93,106,138,93,106,174,93,106,199,93,106,212,93,106,221,93,106,228,93,106,233,93,106,238,93,106,239,93,106,243,93,106,246,93,106,16,127,106,20,127,106,36,127,106,59,127,106,90,127,106,138,127,106,174,127,106,199,127,106,212,127,106,221,127,106,228,127,106,233,127,106,238,127,106,239,127,106,243,127,106,246,127,106,16,166,106,20,166,106,36,166,106,59,166,106,90,166,106,138,166,106,174,166,106,199,166,106,212,166,106,221,166,106,228,166,106,233,166,106,238,166,106,239,166,106,243,166,106,246,166,106,16,194,106,20,194,106,36,194,106,59,194,106,90,194,106,138,194,106,174,194,106,199,194,106,212,194,106,221,194,106,228,194,106,233,194,106,238,194,106,239,194,106,243,194,106,246,194,106,16,213,106,20,213,106,36,213,106,59,213,106,90,213,106,138,213,106,174,213,106,199,213,106,212,213,106,221,213,106,228,213,106,233,213,106,238,213,106,239,213,106,243,213,106,246,213,106,16,223,106,20,223,106,36,223,106,59,223,106,90,223,106,138,223,106,174,223,106,199,223,106,212,223,106,221,223,106,228,223,106,233,223,106,238,223,106,239,223,106,243,223,106,246,223,106,16,230,106,20,230,106,36,230,106,59,230,106,90,230,106,138,230,106,174,230,106,199,230,106,212,230,106,221,230,106,228,230,106,233,230,106,238,230,106,239,230,106,243,230,106,246,230,106,16,236,106,20,236,106,36,236,106,59,236,106,90,236,106,138,236,106,174,236,106,199,236,106,212,236,106,221,236,106,228,236,106,233,236,106,238,236,106,239,236,106,243,236,106,246,236,106,16,240,106,20,240,106,36,240,106,59,240,106,90,240,106,138,240,106,174,240,106,199,240,106,212,240,106,221,240,106,228,240,106,233,240,106,238,240,106,239,240,106,243,240,106,246,240,106,16,243,106,20,243,106,36,243,106,59,243,106,90,243,106,138,243,106,174,243,106,199,243,106,212,243,106,221,243,106,228,243,106,233,243,106,238,243,106,239,243,106,243,243,106,246,243,106,16,246,106,20,246,106,36,246,106,59,246,106,90,246,106,138,246,106,174,246,106,199,246,106,212,246,106,221,246,106,228,246,106,233,246,106,238,246,106,239,246,106,243,246,106,246,246,106,
									16,23,141,20,23,141,36,23,141,59,23,141,90,23,141,138,23,141,174,23,141,199,23,141,212,23,141,221,23,141,228,23,141,233,23,141,238,23,141,239,23,141,243,23,141,246,23,141,16,23,141,20,23,141,36,23,141,59,23,141,90,23,141,138,23,141,174,23,141,199,23,141,212,23,141,221,23,141,228,23,141,233,23,141,238,23,141,239,23,141,243,23,141,246,23,141,16,36,141,20,36,141,36,36,141,59,36,141,90,36,141,138,36,141,174,36,141,199,36,141,212,36,141,221,36,141,228,36,141,233,36,141,238,36,141,239,36,141,243,36,141,246,36,141,16,50,141,20,50,141,36,50,141,59,50,141,90,50,141,138,50,141,174,50,141,199,50,141,212,50,141,221,50,141,228,50,141,233,50,141,238,50,141,239,50,141,243,50,141,246,50,141,16,68,141,20,68,141,36,68,141,59,68,141,90,68,141,138,68,141,174,68,141,199,68,141,212,68,141,221,68,141,228,68,141,233,68,141,238,68,141,239,68,141,243,68,141,246,68,141,16,93,141,20,93,141,36,93,141,59,93,141,90,93,141,138,93,141,174,93,141,199,93,141,212,93,141,221,93,141,228,93,141,233,93,141,238,93,141,239,93,141,243,93,141,246,93,141,16,127,141,20,127,141,36,127,141,59,127,141,90,127,141,138,127,141,174,127,141,199,127,141,212,127,141,221,127,141,228,127,141,233,127,141,238,127,141,239,127,141,243,127,141,246,127,141,16,166,141,20,166,141,36,166,141,59,166,141,90,166,141,138,166,141,174,166,141,199,166,141,212,166,141,221,166,141,228,166,141,233,166,141,238,166,141,239,166,141,243,166,141,246,166,141,16,194,141,20,194,141,36,194,141,59,194,141,90,194,141,138,194,141,174,194,141,199,194,141,212,194,141,221,194,141,228,194,141,233,194,141,238,194,141,239,194,141,243,194,141,246,194,141,16,213,141,20,213,141,36,213,141,59,213,141,90,213,141,138,213,141,174,213,141,199,213,141,212,213,141,221,213,141,228,213,141,233,213,141,238,213,141,239,213,141,243,213,141,246,213,141,16,223,141,20,223,141,36,223,141,59,223,141,90,223,141,138,223,141,174,223,141,199,223,141,212,223,141,221,223,141,228,223,141,233,223,141,238,223,141,239,223,141,243,223,141,246,223,141,16,230,141,20,230,141,36,230,141,59,230,141,90,230,141,138,230,141,174,230,141,199,230,141,212,230,141,221,230,141,228,230,141,233,230,141,238,230,141,239,230,141,243,230,141,246,230,141,16,236,141,20,236,141,36,236,141,59,236,141,90,236,141,138,236,141,174,236,141,199,236,141,212,236,141,221,236,141,228,236,141,233,236,141,238,236,141,239,236,141,243,236,141,246,236,141,16,240,141,20,240,141,36,240,141,59,240,141,90,240,141,138,240,141,174,240,141,199,240,141,212,240,141,221,240,141,228,240,141,233,240,141,238,240,141,239,240,141,243,240,141,246,240,141,16,243,141,20,243,141,36,243,141,59,243,141,90,243,141,138,243,141,174,243,141,199,243,141,212,243,141,221,243,141,228,243,141,233,243,141,238,243,141,239,243,141,243,243,141,246,243,141,16,246,141,20,246,141,36,246,141,59,246,141,90,246,141,138,246,141,174,246,141,199,246,141,212,246,141,221,246,141,228,246,141,233,246,141,238,246,141,239,246,141,243,246,141,246,246,141,
									16,23,173,20,23,173,36,23,173,59,23,173,90,23,173,138,23,173,174,23,173,199,23,173,212,23,173,221,23,173,228,23,173,233,23,173,238,23,173,239,23,173,243,23,173,246,23,173,16,23,173,20,23,173,36,23,173,59,23,173,90,23,173,138,23,173,174,23,173,199,23,173,212,23,173,221,23,173,228,23,173,233,23,173,238,23,173,239,23,173,243,23,173,246,23,173,16,36,173,20,36,173,36,36,173,59,36,173,90,36,173,138,36,173,174,36,173,199,36,173,212,36,173,221,36,173,228,36,173,233,36,173,238,36,173,239,36,173,243,36,173,246,36,173,16,50,173,20,50,173,36,50,173,59,50,173,90,50,173,138,50,173,174,50,173,199,50,173,212,50,173,221,50,173,228,50,173,233,50,173,238,50,173,239,50,173,243,50,173,246,50,173,16,68,173,20,68,173,36,68,173,59,68,173,90,68,173,138,68,173,174,68,173,199,68,173,212,68,173,221,68,173,228,68,173,233,68,173,238,68,173,239,68,173,243,68,173,246,68,173,16,93,173,20,93,173,36,93,173,59,93,173,90,93,173,138,93,173,174,93,173,199,93,173,212,93,173,221,93,173,228,93,173,233,93,173,238,93,173,239,93,173,243,93,173,246,93,173,16,127,173,20,127,173,36,127,173,59,127,173,90,127,173,138,127,173,174,127,173,199,127,173,212,127,173,221,127,173,228,127,173,233,127,173,238,127,173,239,127,173,243,127,173,246,127,173,16,166,173,20,166,173,36,166,173,59,166,173,90,166,173,138,166,173,174,166,173,199,166,173,212,166,173,221,166,173,228,166,173,233,166,173,238,166,173,239,166,173,243,166,173,246,166,173,16,194,173,20,194,173,36,194,173,59,194,173,90,194,173,138,194,173,174,194,173,199,194,173,212,194,173,221,194,173,228,194,173,233,194,173,238,194,173,239,194,173,243,194,173,246,194,173,16,213,173,20,213,173,36,213,173,59,213,173,90,213,173,138,213,173,174,213,173,199,213,173,212,213,173,221,213,173,228,213,173,233,213,173,238,213,173,239,213,173,243,213,173,246,213,173,16,223,173,20,223,173,36,223,173,59,223,173,90,223,173,138,223,173,174,223,173,199,223,173,212,223,173,221,223,173,228,223,173,233,223,173,238,223,173,239,223,173,243,223,173,246,223,173,16,230,173,20,230,173,36,230,173,59,230,173,90,230,173,138,230,173,174,230,173,199,230,173,212,230,173,221,230,173,228,230,173,233,230,173,238,230,173,239,230,173,243,230,173,246,230,173,16,236,173,20,236,173,36,236,173,59,236,173,90,236,173,138,236,173,174,236,173,199,236,173,212,236,173,221,236,173,228,236,173,233,236,173,238,236,173,239,236,173,243,236,173,246,236,173,16,240,173,20,240,173,36,240,173,59,240,173,90,240,173,138,240,173,174,240,173,199,240,173,212,240,173,221,240,173,228,240,173,233,240,173,238,240,173,239,240,173,243,240,173,246,240,173,16,243,173,20,243,173,36,243,173,59,243,173,90,243,173,138,243,173,174,243,173,199,243,173,212,243,173,221,243,173,228,243,173,233,243,173,238,243,173,239,243,173,243,243,173,246,243,173,16,246,173,20,246,173,36,246,173,59,246,173,90,246,173,138,246,173,174,246,173,199,246,173,212,246,173,221,246,173,228,246,173,233,246,173,238,246,173,239,246,173,243,246,173,246,246,173,
									16,23,200,20,23,200,36,23,200,59,23,200,90,23,200,138,23,200,174,23,200,199,23,200,212,23,200,221,23,200,228,23,200,233,23,200,238,23,200,239,23,200,243,23,200,246,23,200,16,23,200,20,23,200,36,23,200,59,23,200,90,23,200,138,23,200,174,23,200,199,23,200,212,23,200,221,23,200,228,23,200,233,23,200,238,23,200,239,23,200,243,23,200,246,23,200,16,36,200,20,36,200,36,36,200,59,36,200,90,36,200,138,36,200,174,36,200,199,36,200,212,36,200,221,36,200,228,36,200,233,36,200,238,36,200,239,36,200,243,36,200,246,36,200,16,50,200,20,50,200,36,50,200,59,50,200,90,50,200,138,50,200,174,50,200,199,50,200,212,50,200,221,50,200,228,50,200,233,50,200,238,50,200,239,50,200,243,50,200,246,50,200,16,68,200,20,68,200,36,68,200,59,68,200,90,68,200,138,68,200,174,68,200,199,68,200,212,68,200,221,68,200,228,68,200,233,68,200,238,68,200,239,68,200,243,68,200,246,68,200,16,93,200,20,93,200,36,93,200,59,93,200,90,93,200,138,93,200,174,93,200,199,93,200,212,93,200,221,93,200,228,93,200,233,93,200,238,93,200,239,93,200,243,93,200,246,93,200,16,127,200,20,127,200,36,127,200,59,127,200,90,127,200,138,127,200,174,127,200,199,127,200,212,127,200,221,127,200,228,127,200,233,127,200,238,127,200,239,127,200,243,127,200,246,127,200,16,166,200,20,166,200,36,166,200,59,166,200,90,166,200,138,166,200,174,166,200,199,166,200,212,166,200,221,166,200,228,166,200,233,166,200,238,166,200,239,166,200,243,166,200,246,166,200,16,194,200,20,194,200,36,194,200,59,194,200,90,194,200,138,194,200,174,194,200,199,194,200,212,194,200,221,194,200,228,194,200,233,194,200,238,194,200,239,194,200,243,194,200,246,194,200,16,213,200,20,213,200,36,213,200,59,213,200,90,213,200,138,213,200,174,213,200,199,213,200,212,213,200,221,213,200,228,213,200,233,213,200,238,213,200,239,213,200,243,213,200,246,213,200,16,223,200,20,223,200,36,223,200,59,223,200,90,223,200,138,223,200,174,223,200,199,223,200,212,223,200,221,223,200,228,223,200,233,223,200,238,223,200,239,223,200,243,223,200,246,223,200,16,230,200,20,230,200,36,230,200,59,230,200,90,230,200,138,230,200,174,230,200,199,230,200,212,230,200,221,230,200,228,230,200,233,230,200,238,230,200,239,230,200,243,230,200,246,230,200,16,236,200,20,236,200,36,236,200,59,236,200,90,236,200,138,236,200,174,236,200,199,236,200,212,236,200,221,236,200,228,236,200,233,236,200,238,236,200,239,236,200,243,236,200,246,236,200,16,240,200,20,240,200,36,240,200,59,240,200,90,240,200,138,240,200,174,240,200,199,240,200,212,240,200,221,240,200,228,240,200,233,240,200,238,240,200,239,240,200,243,240,200,246,240,200,16,243,200,20,243,200,36,243,200,59,243,200,90,243,200,138,243,200,174,243,200,199,243,200,212,243,200,221,243,200,228,243,200,233,243,200,238,243,200,239,243,200,243,243,200,246,243,200,16,246,200,20,246,200,36,246,200,59,246,200,90,246,200,138,246,200,174,246,200,199,246,200,212,246,200,221,246,200,228,246,200,233,246,200,238,246,200,239,246,200,243,246,200,246,246,200,
									16,23,216,20,23,216,36,23,216,59,23,216,90,23,216,138,23,216,174,23,216,199,23,216,212,23,216,221,23,216,228,23,216,233,23,216,238,23,216,239,23,216,243,23,216,246,23,216,16,23,216,20,23,216,36,23,216,59,23,216,90,23,216,138,23,216,174,23,216,199,23,216,212,23,216,221,23,216,228,23,216,233,23,216,238,23,216,239,23,216,243,23,216,246,23,216,16,36,216,20,36,216,36,36,216,59,36,216,90,36,216,138,36,216,174,36,216,199,36,216,212,36,216,221,36,216,228,36,216,233,36,216,238,36,216,239,36,216,243,36,216,246,36,216,16,50,216,20,50,216,36,50,216,59,50,216,90,50,216,138,50,216,174,50,216,199,50,216,212,50,216,221,50,216,228,50,216,233,50,216,238,50,216,239,50,216,243,50,216,246,50,216,16,68,216,20,68,216,36,68,216,59,68,216,90,68,216,138,68,216,174,68,216,199,68,216,212,68,216,221,68,216,228,68,216,233,68,216,238,68,216,239,68,216,243,68,216,246,68,216,16,93,216,20,93,216,36,93,216,59,93,216,90,93,216,138,93,216,174,93,216,199,93,216,212,93,216,221,93,216,228,93,216,233,93,216,238,93,216,239,93,216,243,93,216,246,93,216,16,127,216,20,127,216,36,127,216,59,127,216,90,127,216,138,127,216,174,127,216,199,127,216,212,127,216,221,127,216,228,127,216,233,127,216,238,127,216,239,127,216,243,127,216,246,127,216,16,166,216,20,166,216,36,166,216,59,166,216,90,166,216,138,166,216,174,166,216,199,166,216,212,166,216,221,166,216,228,166,216,233,166,216,238,166,216,239,166,216,243,166,216,246,166,216,16,194,216,20,194,216,36,194,216,59,194,216,90,194,216,138,194,216,174,194,216,199,194,216,212,194,216,221,194,216,228,194,216,233,194,216,238,194,216,239,194,216,243,194,216,246,194,216,16,213,216,20,213,216,36,213,216,59,213,216,90,213,216,138,213,216,174,213,216,199,213,216,212,213,216,221,213,216,228,213,216,233,213,216,238,213,216,239,213,216,243,213,216,246,213,216,16,223,216,20,223,216,36,223,216,59,223,216,90,223,216,138,223,216,174,223,216,199,223,216,212,223,216,221,223,216,228,223,216,233,223,216,238,223,216,239,223,216,243,223,216,246,223,216,16,230,216,20,230,216,36,230,216,59,230,216,90,230,216,138,230,216,174,230,216,199,230,216,212,230,216,221,230,216,228,230,216,233,230,216,238,230,216,239,230,216,243,230,216,246,230,216,16,236,216,20,236,216,36,236,216,59,236,216,90,236,216,138,236,216,174,236,216,199,236,216,212,236,216,221,236,216,228,236,216,233,236,216,238,236,216,239,236,216,243,236,216,246,236,216,16,240,216,20,240,216,36,240,216,59,240,216,90,240,216,138,240,216,174,240,216,199,240,216,212,240,216,221,240,216,228,240,216,233,240,216,238,240,216,239,240,216,243,240,216,246,240,216,16,243,216,20,243,216,36,243,216,59,243,216,90,243,216,138,243,216,174,243,216,199,243,216,212,243,216,221,243,216,228,243,216,233,243,216,238,243,216,239,243,216,243,243,216,246,243,216,16,246,216,20,246,216,36,246,216,59,246,216,90,246,216,138,246,216,174,246,216,199,246,216,212,246,216,221,246,216,228,246,216,233,246,216,238,246,216,239,246,216,243,246,216,246,246,216,
									16,23,227,20,23,227,36,23,227,59,23,227,90,23,227,138,23,227,174,23,227,199,23,227,212,23,227,221,23,227,228,23,227,233,23,227,238,23,227,239,23,227,243,23,227,246,23,227,16,23,227,20,23,227,36,23,227,59,23,227,90,23,227,138,23,227,174,23,227,199,23,227,212,23,227,221,23,227,228,23,227,233,23,227,238,23,227,239,23,227,243,23,227,246,23,227,16,36,227,20,36,227,36,36,227,59,36,227,90,36,227,138,36,227,174,36,227,199,36,227,212,36,227,221,36,227,228,36,227,233,36,227,238,36,227,239,36,227,243,36,227,246,36,227,16,50,227,20,50,227,36,50,227,59,50,227,90,50,227,138,50,227,174,50,227,199,50,227,212,50,227,221,50,227,228,50,227,233,50,227,238,50,227,239,50,227,243,50,227,246,50,227,16,68,227,20,68,227,36,68,227,59,68,227,90,68,227,138,68,227,174,68,227,199,68,227,212,68,227,221,68,227,228,68,227,233,68,227,238,68,227,239,68,227,243,68,227,246,68,227,16,93,227,20,93,227,36,93,227,59,93,227,90,93,227,138,93,227,174,93,227,199,93,227,212,93,227,221,93,227,228,93,227,233,93,227,238,93,227,239,93,227,243,93,227,246,93,227,16,127,227,20,127,227,36,127,227,59,127,227,90,127,227,138,127,227,174,127,227,199,127,227,212,127,227,221,127,227,228,127,227,233,127,227,238,127,227,239,127,227,243,127,227,246,127,227,16,166,227,20,166,227,36,166,227,59,166,227,90,166,227,138,166,227,174,166,227,199,166,227,212,166,227,221,166,227,228,166,227,233,166,227,238,166,227,239,166,227,243,166,227,246,166,227,16,194,227,20,194,227,36,194,227,59,194,227,90,194,227,138,194,227,174,194,227,199,194,227,212,194,227,221,194,227,228,194,227,233,194,227,238,194,227,239,194,227,243,194,227,246,194,227,16,213,227,20,213,227,36,213,227,59,213,227,90,213,227,138,213,227,174,213,227,199,213,227,212,213,227,221,213,227,228,213,227,233,213,227,238,213,227,239,213,227,243,213,227,246,213,227,16,223,227,20,223,227,36,223,227,59,223,227,90,223,227,138,223,227,174,223,227,199,223,227,212,223,227,221,223,227,228,223,227,233,223,227,238,223,227,239,223,227,243,223,227,246,223,227,16,230,227,20,230,227,36,230,227,59,230,227,90,230,227,138,230,227,174,230,227,199,230,227,212,230,227,221,230,227,228,230,227,233,230,227,238,230,227,239,230,227,243,230,227,246,230,227,16,236,227,20,236,227,36,236,227,59,236,227,90,236,227,138,236,227,174,236,227,199,236,227,212,236,227,221,236,227,228,236,227,233,236,227,238,236,227,239,236,227,243,236,227,246,236,227,16,240,227,20,240,227,36,240,227,59,240,227,90,240,227,138,240,227,174,240,227,199,240,227,212,240,227,221,240,227,228,240,227,233,240,227,238,240,227,239,240,227,243,240,227,246,240,227,16,243,227,20,243,227,36,243,227,59,243,227,90,243,227,138,243,227,174,243,227,199,243,227,212,243,227,221,243,227,228,243,227,233,243,227,238,243,227,239,243,227,243,243,227,246,243,227,16,246,227,20,246,227,36,246,227,59,246,227,90,246,227,138,246,227,174,246,227,199,246,227,212,246,227,221,246,227,228,246,227,233,246,227,238,246,227,239,246,227,243,246,227,246,246,227,
									16,23,232,20,23,232,36,23,232,59,23,232,90,23,232,138,23,232,174,23,232,199,23,232,212,23,232,221,23,232,228,23,232,233,23,232,238,23,232,239,23,232,243,23,232,246,23,232,16,23,232,20,23,232,36,23,232,59,23,232,90,23,232,138,23,232,174,23,232,199,23,232,212,23,232,221,23,232,228,23,232,233,23,232,238,23,232,239,23,232,243,23,232,246,23,232,16,36,232,20,36,232,36,36,232,59,36,232,90,36,232,138,36,232,174,36,232,199,36,232,212,36,232,221,36,232,228,36,232,233,36,232,238,36,232,239,36,232,243,36,232,246,36,232,16,50,232,20,50,232,36,50,232,59,50,232,90,50,232,138,50,232,174,50,232,199,50,232,212,50,232,221,50,232,228,50,232,233,50,232,238,50,232,239,50,232,243,50,232,246,50,232,16,68,232,20,68,232,36,68,232,59,68,232,90,68,232,138,68,232,174,68,232,199,68,232,212,68,232,221,68,232,228,68,232,233,68,232,238,68,232,239,68,232,243,68,232,246,68,232,16,93,232,20,93,232,36,93,232,59,93,232,90,93,232,138,93,232,174,93,232,199,93,232,212,93,232,221,93,232,228,93,232,233,93,232,238,93,232,239,93,232,243,93,232,246,93,232,16,127,232,20,127,232,36,127,232,59,127,232,90,127,232,138,127,232,174,127,232,199,127,232,212,127,232,221,127,232,228,127,232,233,127,232,238,127,232,239,127,232,243,127,232,246,127,232,16,166,232,20,166,232,36,166,232,59,166,232,90,166,232,138,166,232,174,166,232,199,166,232,212,166,232,221,166,232,228,166,232,233,166,232,238,166,232,239,166,232,243,166,232,246,166,232,16,194,232,20,194,232,36,194,232,59,194,232,90,194,232,138,194,232,174,194,232,199,194,232,212,194,232,221,194,232,228,194,232,233,194,232,238,194,232,239,194,232,243,194,232,246,194,232,16,213,232,20,213,232,36,213,232,59,213,232,90,213,232,138,213,232,174,213,232,199,213,232,212,213,232,221,213,232,228,213,232,233,213,232,238,213,232,239,213,232,243,213,232,246,213,232,16,223,232,20,223,232,36,223,232,59,223,232,90,223,232,138,223,232,174,223,232,199,223,232,212,223,232,221,223,232,228,223,232,233,223,232,238,223,232,239,223,232,243,223,232,246,223,232,16,230,232,20,230,232,36,230,232,59,230,232,90,230,232,138,230,232,174,230,232,199,230,232,212,230,232,221,230,232,228,230,232,233,230,232,238,230,232,239,230,232,243,230,232,246,230,232,16,236,232,20,236,232,36,236,232,59,236,232,90,236,232,138,236,232,174,236,232,199,236,232,212,236,232,221,236,232,228,236,232,233,236,232,238,236,232,239,236,232,243,236,232,246,236,232,16,240,232,20,240,232,36,240,232,59,240,232,90,240,232,138,240,232,174,240,232,199,240,232,212,240,232,221,240,232,228,240,232,233,240,232,238,240,232,239,240,232,243,240,232,246,240,232,16,243,232,20,243,232,36,243,232,59,243,232,90,243,232,138,243,232,174,243,232,199,243,232,212,243,232,221,243,232,228,243,232,233,243,232,238,243,232,239,243,232,243,243,232,246,243,232,16,246,232,20,246,232,36,246,232,59,246,232,90,246,232,138,246,232,174,246,232,199,246,232,212,246,232,221,246,232,228,246,232,233,246,232,238,246,232,239,246,232,243,246,232,246,246,232,
									16,23,239,20,23,239,36,23,239,59,23,239,90,23,239,138,23,239,174,23,239,199,23,239,212,23,239,221,23,239,228,23,239,233,23,239,238,23,239,239,23,239,243,23,239,246,23,239,16,23,239,20,23,239,36,23,239,59,23,239,90,23,239,138,23,239,174,23,239,199,23,239,212,23,239,221,23,239,228,23,239,233,23,239,238,23,239,239,23,239,243,23,239,246,23,239,16,36,239,20,36,239,36,36,239,59,36,239,90,36,239,138,36,239,174,36,239,199,36,239,212,36,239,221,36,239,228,36,239,233,36,239,238,36,239,239,36,239,243,36,239,246,36,239,16,50,239,20,50,239,36,50,239,59,50,239,90,50,239,138,50,239,174,50,239,199,50,239,212,50,239,221,50,239,228,50,239,233,50,239,238,50,239,239,50,239,243,50,239,246,50,239,16,68,239,20,68,239,36,68,239,59,68,239,90,68,239,138,68,239,174,68,239,199,68,239,212,68,239,221,68,239,228,68,239,233,68,239,238,68,239,239,68,239,243,68,239,246,68,239,16,93,239,20,93,239,36,93,239,59,93,239,90,93,239,138,93,239,174,93,239,199,93,239,212,93,239,221,93,239,228,93,239,233,93,239,238,93,239,239,93,239,243,93,239,246,93,239,16,127,239,20,127,239,36,127,239,59,127,239,90,127,239,138,127,239,174,127,239,199,127,239,212,127,239,221,127,239,228,127,239,233,127,239,238,127,239,239,127,239,243,127,239,246,127,239,16,166,239,20,166,239,36,166,239,59,166,239,90,166,239,138,166,239,174,166,239,199,166,239,212,166,239,221,166,239,228,166,239,233,166,239,238,166,239,239,166,239,243,166,239,246,166,239,16,194,239,20,194,239,36,194,239,59,194,239,90,194,239,138,194,239,174,194,239,199,194,239,212,194,239,221,194,239,228,194,239,233,194,239,238,194,239,239,194,239,243,194,239,246,194,239,16,213,239,20,213,239,36,213,239,59,213,239,90,213,239,138,213,239,174,213,239,199,213,239,212,213,239,221,213,239,228,213,239,233,213,239,238,213,239,239,213,239,243,213,239,246,213,239,16,223,239,20,223,239,36,223,239,59,223,239,90,223,239,138,223,239,174,223,239,199,223,239,212,223,239,221,223,239,228,223,239,233,223,239,238,223,239,239,223,239,243,223,239,246,223,239,16,230,239,20,230,239,36,230,239,59,230,239,90,230,239,138,230,239,174,230,239,199,230,239,212,230,239,221,230,239,228,230,239,233,230,239,238,230,239,239,230,239,243,230,239,246,230,239,16,236,239,20,236,239,36,236,239,59,236,239,90,236,239,138,236,239,174,236,239,199,236,239,212,236,239,221,236,239,228,236,239,233,236,239,238,236,239,239,236,239,243,236,239,246,236,239,16,240,239,20,240,239,36,240,239,59,240,239,90,240,239,138,240,239,174,240,239,199,240,239,212,240,239,221,240,239,228,240,239,233,240,239,238,240,239,239,240,239,243,240,239,246,240,239,16,243,239,20,243,239,36,243,239,59,243,239,90,243,239,138,243,239,174,243,239,199,243,239,212,243,239,221,243,239,228,243,239,233,243,239,238,243,239,239,243,239,243,243,239,246,243,239,16,246,239,20,246,239,36,246,239,59,246,239,90,246,239,138,246,239,174,246,239,199,246,239,212,246,239,221,246,239,228,246,239,233,246,239,238,246,239,239,246,239,243,246,239,246,246,239,
									16,23,243,20,23,243,36,23,243,59,23,243,90,23,243,138,23,243,174,23,243,199,23,243,212,23,243,221,23,243,228,23,243,233,23,243,238,23,243,239,23,243,243,23,243,246,23,243,16,23,243,20,23,243,36,23,243,59,23,243,90,23,243,138,23,243,174,23,243,199,23,243,212,23,243,221,23,243,228,23,243,233,23,243,238,23,243,239,23,243,243,23,243,246,23,243,16,36,243,20,36,243,36,36,243,59,36,243,90,36,243,138,36,243,174,36,243,199,36,243,212,36,243,221,36,243,228,36,243,233,36,243,238,36,243,239,36,243,243,36,243,246,36,243,16,50,243,20,50,243,36,50,243,59,50,243,90,50,243,138,50,243,174,50,243,199,50,243,212,50,243,221,50,243,228,50,243,233,50,243,238,50,243,239,50,243,243,50,243,246,50,243,16,68,243,20,68,243,36,68,243,59,68,243,90,68,243,138,68,243,174,68,243,199,68,243,212,68,243,221,68,243,228,68,243,233,68,243,238,68,243,239,68,243,243,68,243,246,68,243,16,93,243,20,93,243,36,93,243,59,93,243,90,93,243,138,93,243,174,93,243,199,93,243,212,93,243,221,93,243,228,93,243,233,93,243,238,93,243,239,93,243,243,93,243,246,93,243,16,127,243,20,127,243,36,127,243,59,127,243,90,127,243,138,127,243,174,127,243,199,127,243,212,127,243,221,127,243,228,127,243,233,127,243,238,127,243,239,127,243,243,127,243,246,127,243,16,166,243,20,166,243,36,166,243,59,166,243,90,166,243,138,166,243,174,166,243,199,166,243,212,166,243,221,166,243,228,166,243,233,166,243,238,166,243,239,166,243,243,166,243,246,166,243,16,194,243,20,194,243,36,194,243,59,194,243,90,194,243,138,194,243,174,194,243,199,194,243,212,194,243,221,194,243,228,194,243,233,194,243,238,194,243,239,194,243,243,194,243,246,194,243,16,213,243,20,213,243,36,213,243,59,213,243,90,213,243,138,213,243,174,213,243,199,213,243,212,213,243,221,213,243,228,213,243,233,213,243,238,213,243,239,213,243,243,213,243,246,213,243,16,223,243,20,223,243,36,223,243,59,223,243,90,223,243,138,223,243,174,223,243,199,223,243,212,223,243,221,223,243,228,223,243,233,223,243,238,223,243,239,223,243,243,223,243,246,223,243,16,230,243,20,230,243,36,230,243,59,230,243,90,230,243,138,230,243,174,230,243,199,230,243,212,230,243,221,230,243,228,230,243,233,230,243,238,230,243,239,230,243,243,230,243,246,230,243,16,236,243,20,236,243,36,236,243,59,236,243,90,236,243,138,236,243,174,236,243,199,236,243,212,236,243,221,236,243,228,236,243,233,236,243,238,236,243,239,236,243,243,236,243,246,236,243,16,240,243,20,240,243,36,240,243,59,240,243,90,240,243,138,240,243,174,240,243,199,240,243,212,240,243,221,240,243,228,240,243,233,240,243,238,240,243,239,240,243,243,240,243,246,240,243,16,243,243,20,243,243,36,243,243,59,243,243,90,243,243,138,243,243,174,243,243,199,243,243,212,243,243,221,243,243,228,243,243,233,243,243,238,243,243,239,243,243,243,243,243,246,243,243,16,246,243,20,246,243,36,246,243,59,246,243,90,246,243,138,246,243,174,246,243,199,246,243,212,246,243,221,246,243,228,246,243,233,246,243,238,246,243,239,246,243,243,246,243,246,246,243,
									16,23,246,20,23,246,36,23,246,59,23,246,90,23,246,138,23,246,174,23,246,199,23,246,212,23,246,221,23,246,228,23,246,233,23,246,238,23,246,239,23,246,243,23,246,246,23,246,16,23,246,20,23,246,36,23,246,59,23,246,90,23,246,138,23,246,174,23,246,199,23,246,212,23,246,221,23,246,228,23,246,233,23,246,238,23,246,239,23,246,243,23,246,246,23,246,16,36,246,20,36,246,36,36,246,59,36,246,90,36,246,138,36,246,174,36,246,199,36,246,212,36,246,221,36,246,228,36,246,233,36,246,238,36,246,239,36,246,243,36,246,246,36,246,16,50,246,20,50,246,36,50,246,59,50,246,90,50,246,138,50,246,174,50,246,199,50,246,212,50,246,221,50,246,228,50,246,233,50,246,238,50,246,239,50,246,243,50,246,246,50,246,16,68,246,20,68,246,36,68,246,59,68,246,90,68,246,138,68,246,174,68,246,199,68,246,212,68,246,221,68,246,228,68,246,233,68,246,238,68,246,239,68,246,243,68,246,246,68,246,16,93,246,20,93,246,36,93,246,59,93,246,90,93,246,138,93,246,174,93,246,199,93,246,212,93,246,221,93,246,228,93,246,233,93,246,238,93,246,239,93,246,243,93,246,246,93,246,16,127,246,20,127,246,36,127,246,59,127,246,90,127,246,138,127,246,174,127,246,199,127,246,212,127,246,221,127,246,228,127,246,233,127,246,238,127,246,239,127,246,243,127,246,246,127,246,16,166,246,20,166,246,36,166,246,59,166,246,90,166,246,138,166,246,174,166,246,199,166,246,212,166,246,221,166,246,228,166,246,233,166,246,238,166,246,239,166,246,243,166,246,246,166,246,16,194,246,20,194,246,36,194,246,59,194,246,90,194,246,138,194,246,174,194,246,199,194,246,212,194,246,221,194,246,228,194,246,233,194,246,238,194,246,239,194,246,243,194,246,246,194,246,16,213,246,20,213,246,36,213,246,59,213,246,90,213,246,138,213,246,174,213,246,199,213,246,212,213,246,221,213,246,228,213,246,233,213,246,238,213,246,239,213,246,243,213,246,246,213,246,16,223,246,20,223,246,36,223,246,59,223,246,90,223,246,138,223,246,174,223,246,199,223,246,212,223,246,221,223,246,228,223,246,233,223,246,238,223,246,239,223,246,243,223,246,246,223,246,16,230,246,20,230,246,36,230,246,59,230,246,90,230,246,138,230,246,174,230,246,199,230,246,212,230,246,221,230,246,228,230,246,233,230,246,238,230,246,239,230,246,243,230,246,246,230,246,16,236,246,20,236,246,36,236,246,59,236,246,90,236,246,138,236,246,174,236,246,199,236,246,212,236,246,221,236,246,228,236,246,233,236,246,238,236,246,239,236,246,243,236,246,246,236,246,16,240,246,20,240,246,36,240,246,59,240,246,90,240,246,138,240,246,174,240,246,199,240,246,212,240,246,221,240,246,228,240,246,233,240,246,238,240,246,239,240,246,243,240,246,246,240,246,16,243,246,20,243,246,36,243,246,59,243,246,90,243,246,138,243,246,174,243,246,199,243,246,212,243,246,221,243,246,228,243,246,233,243,246,238,243,246,239,243,246,243,243,246,246,243,246,16,246,246,20,246,246,36,246,246,59,246,246,90,246,246,138,246,246,174,246,246,199,246,246,212,246,246,221,246,246,228,246,246,233,246,246,238,246,246,239,246,246,243,246,246,246,246,246,
								   };

int texture_color_correction = 0;


int genTexture(unsigned char* data, int width, int height, int depth) {
	glEnable(GL_TEXTURE_3D);
	int texture;
	glGenTextures(1,&texture);
	glBindTexture(GL_TEXTURE_3D,texture);
	glTexImage3D(GL_TEXTURE_3D,0,GL_RGB,width,height,depth,0,GL_RGB,GL_UNSIGNED_BYTE,data);
	glTexParameteri(GL_TEXTURE_3D,GL_TEXTURE_WRAP_S,GL_CLAMP_TO_EDGE);
	glTexParameteri(GL_TEXTURE_3D,GL_TEXTURE_WRAP_T,GL_CLAMP_TO_EDGE);
	glTexParameteri(GL_TEXTURE_3D,GL_TEXTURE_WRAP_R,GL_CLAMP_TO_EDGE);
	glTexParameteri(GL_TEXTURE_3D,GL_TEXTURE_MIN_FILTER,GL_LINEAR);
	glTexParameteri(GL_TEXTURE_3D,GL_TEXTURE_MAG_FILTER,GL_LINEAR);
	glBindTexture(GL_TEXTURE_3D,0);
	glDisable(GL_TEXTURE_3D);
	return texture;
}

int time_last_frame = 0;

float lx = 232.91F,ly = 1.6F,lz = 313.66F;
float hj = 0,hk = 0,hl = 0;

unsigned int block_color = 0x00008000;

void render_man(float x, float z) {
	/*glPushMatrix();
	glTranslatef(lx+x,ly+0.4F,lz+z);
	//glScalef(0.015625F,0.015625F,0.015625F);
	kv6_render(&tent,255,0,0);
	glPopMatrix();
	
	glPushMatrix();
	glTranslatef(lx+x+1.125F,ly+0.4F,lz+z);
	//glScalef(-0.015625F,0.015625F,0.015625F);
	kv6_render(&tent,255,0,0);
	glPopMatrix();
	
	glPushMatrix();
	glTranslatef(lx+x+0.1F,ly+1.4F,lz+z+1.25F);
	//glScalef(0.015625F,0.015625F,0.015625F);
	kv6_render(&gun,255,0,0);
	glPopMatrix();*/
}

void update_point_size(float scale) {
	float heightOfNearPlane = (float)settings.window_height/(2.0F*tan(camera_fov*1.570796F/180.0F));
	if(settings.opengl14) {
		glPointSize(2.422F*scale*heightOfNearPlane);
		float distance_attenuation[] = {0.0F,0.0F,1.0F};
		glPointParameterfv(GL_POINT_DISTANCE_ATTENUATION,distance_attenuation);
	} else {
		glUniform1f(uniform_point_size, scale);
		glUniform1f(uniform_near_plane_height, heightOfNearPlane);
	}
}

float drawScene(boolean shadowed) {
	if(settings.ambient_occlusion) {
		glShadeModel(GL_SMOOTH);
	} else {
		glShadeModel(GL_FLAT);
	}
	
	glEnableClientState(GL_COLOR_ARRAY);
	glEnableClientState(GL_VERTEX_ARRAY);
	float r = chunk_draw_visible(shadowed);

	/*update_point_size(0.015625F);
	glPushMatrix();
	glTranslatef(lx,ly+0.4F,lz);
	glScalef(0.015625F,0.015625F,0.015625F);
	kv6_render(&tent,255,0,0);
	glPopMatrix();*/
	
	glDisableClientState(GL_VERTEX_ARRAY);
	glDisableClientState(GL_COLOR_ARRAY);
	
	glShadeModel(GL_FLAT);
	particle_render();
	
	return r;
}

int anim_length = 17;
int anim_index = 16;
int anim_start = 0;
float fps_max = 0.0F;
float fps_min = 10000.0F;
float fps_last[100] = {0};
float per_last[100] = {0};
int fps_last_update = 0;

float anim_points[] =  {54.691128F,12.567106F,365.963867F,2.440803F,1.651999F,5000,
						82.248932F,10.129058F,340.047241F,2.200801F,1.582000F,5000,
						104.732666F,10.187197F,326.952881F,1.728799F,1.576000F,5000,
						155.985260F,5.519114F,322.422241F,1.578801F,1.650001F,5000,
						214.143021F,5.839133F,323.926208F,1.566801F,1.560002F,5000,
						245.116989F,6.149952F,324.006989F,2.928800F,1.592002F,5000,
						307.642273F,16.940989F,312.554016F,4.062802F,1.636001F,5000,
						303.008362F,33.992153F,253.042770F,5.518809F,1.956002F,5000,
						272.819885F,46.366451F,217.858841F,5.916812F,2.066001F,5000,
						232.354660F,63.937710F,182.270370F,6.328799F,2.132004F,5000,
						210.657944F,37.654396F,207.830078F,5.650809F,2.186007F,5000,
						194.229782F,9.483451F,244.884735F,6.248809F,1.680004F,5000,
						203.525452F,7.917942F,256.630676F,7.856788F,1.604006F,5000,
						246.389465F,10.553116F,255.878586F,6.206803F,1.680005F,5000,
						248.953827F,21.124697F,319.168976F,4.452798F,1.762000F,5000,
						230.197281F,42.232132F,384.512268F,3.486796F,2.081999F,5000,
						157.539017F,58.230267F,394.350433F,2.516798F,2.127999F,5000};

float interpolatecos(float value1, float value2, float factor) {
  return value1*((cos(1.5707F*factor)+1.0F)/2.0F) + value2*(1.0F-(cos(1.5707F*factor)+1.0F)/2.0F);
}
					
void display() {
	float fog_color[] = {0.5F,0.9098F,1.0F,1.0F};
	glClearColor(fog_color[0],fog_color[1],fog_color[2],fog_color[3]);
	
	/*if((timems()-anim_start)>anim_points[anim_index*6+5]) {
		anim_index++;
		if(anim_index==anim_length) {
			anim_index = 0;
		}
		anim_start = timems();
	}
	int tmp_ind = anim_index+1;
	if(tmp_ind==anim_length) {
		tmp_ind = 0;
	}
	float dt = (float)(timems()-anim_start)/(float)anim_points[anim_index*6+5];
	camera_x = interpolatecos(anim_points[anim_index*6],anim_points[tmp_ind*6],dt*2.0F);
	camera_y = interpolatecos(anim_points[anim_index*6+1],anim_points[tmp_ind*6+1],dt*2.0F);
	camera_z = interpolatecos(anim_points[anim_index*6+2],anim_points[tmp_ind*6+2],dt*2.0F);
	camera_rot_x = interpolatecos(anim_points[anim_index*6+3],anim_points[tmp_ind*6+3],dt*2.0F);
	camera_rot_y = interpolatecos(anim_points[anim_index*6+4],anim_points[tmp_ind*6+4],dt*2.0F);
	
	/*camera_x = (anim_points[tmp_ind*6]-anim_points[anim_index*6])*dt+anim_points[anim_index*6];
	camera_y = (anim_points[tmp_ind*6+1]-anim_points[anim_index*6+1])*dt+anim_points[anim_index*6+1];
	camera_z = (anim_points[tmp_ind*6+2]-anim_points[anim_index*6+2])*dt+anim_points[anim_index*6+2];
	camera_rot_x = (anim_points[tmp_ind*6+3]-anim_points[anim_index*6+3])*dt+anim_points[anim_index*6+3];
	camera_rot_y = (anim_points[tmp_ind*6+4]-anim_points[anim_index*6+4])*dt+anim_points[anim_index*6+4];*/
	/*printf("%f%% index: %i\n",dt*100.0F,anim_index);
	printf("%0.1f %0.1f %0.1f\n",camera_x,camera_y,camera_z);
	printf("Fps min: %0.1f max: %0.1f\n",fps_min,fps_max);*/
	
	
	if(settings.opengl14) {
		glFogi(GL_FOG_MODE,GL_LINEAR);
		glFogfv(GL_FOG_COLOR,fog_color);
		glFogf(GL_FOG_START,settings.render_distance*0.375F);
		glFogf(GL_FOG_END,settings.render_distance);
		glEnable(GL_FOG);
	} else {
		glDisable(GL_FOG);
		glUniform1f(uniform_fog_distance,settings.render_distance);
		glUniform1f(uniform_camera_x,camera_x);
		glUniform1f(uniform_camera_z,camera_z);
		glUniform1f(uniform_map_size_x,map_size_x);
		glUniform1f(uniform_map_size_z,map_size_z);
		glUniform4f(uniform_fog_color,fog_color[0],fog_color[1],fog_color[2],fog_color[3]);
		glUniform1i(uniform_setting_color_correction, settings.color_correction);
		glUniform1i(uniform_draw_ui, false);
	}
	
	if(!settings.opengl14 && settings.color_correction) {
		glEnable(GL_TEXTURE_3D);
		glBindTexture(GL_TEXTURE_3D,texture_color_correction);
	} else {
		if(!settings.opengl14) {
			glDisable(GL_TEXTURE_3D);
		}
	}

	chunk_update_all();
	
	glClear(GL_COLOR_BUFFER_BIT | GL_DEPTH_BUFFER_BIT | (GL_STENCIL_BUFFER_BIT*settings.shadow_entities));

	if(settings.opengl14) {
		glMatrixMode(GL_PROJECTION);
		glLoadIdentity();
		gluPerspective(camera_fov, ((float)settings.window_width)/((float)settings.window_height), 0.1F, settings.render_distance+CHUNK_SIZE*4.0F+128.0F);
		glMatrixMode(GL_MODELVIEW);
		glLoadIdentity();
		gluLookAt(camera_x, camera_y, camera_z, camera_x+sin(camera_rot_x)*sin(camera_rot_y), camera_y+cos(camera_rot_y), camera_z+cos(camera_rot_x)*sin(camera_rot_y), 0.0F, 1.0F, 0.0F);
	} else {
		glMatrixMode(GL_PROJECTION);
		glLoadIdentity();
		gluPerspective(camera_fov, ((float)settings.window_width)/((float)settings.window_height), 0.1F, settings.render_distance+CHUNK_SIZE*4.0F);
		gluLookAt(camera_x, camera_y, camera_z, camera_x+sin(camera_rot_x)*sin(camera_rot_y), camera_y+cos(camera_rot_y), camera_z+cos(camera_rot_x)*sin(camera_rot_y), 0.0F, 1.0F, 0.0F);
		glMatrixMode(GL_MODELVIEW);
		glLoadIdentity();
	}

	camera_ExtractFrustum();
	
	AABB camera;
	
	aabb_set_size(&camera,camera_size,camera_height,camera_size);
	aabb_set_center(&camera,camera_x,camera_y-camera_eye_height,camera_z);

	float per = 0.0F;
	if(!chunk_geometry_rebuild) {
		
		if(settings.shadow_entities) {
			drawScene(true);
			
			glEnable(GL_STENCIL_TEST);
			glDepthMask(GL_FALSE);
			glColorMask(0,0,0,0);
			glStencilFunc(GL_ALWAYS,0,0);
			glCullFace(GL_FRONT);
			glStencilOp(GL_KEEP,GL_KEEP,GL_INCR_WRAP);
			chunk_draw_shadow_volume(particles_vertices,vertex_index);
			glCullFace(GL_BACK);
			glStencilOp(GL_KEEP,GL_KEEP,GL_DECR_WRAP);
			chunk_draw_shadow_volume(particles_vertices,vertex_index);
			glDepthMask(GL_TRUE);
			glColorMask(1,1,1,1);
			glCullFace(GL_BACK);
			glStencilFunc(GL_EQUAL,0,255);
			glStencilOp(GL_KEEP,GL_KEEP,GL_KEEP);
			
			per = drawScene(false);
			
			glDisable(GL_STENCIL_TEST);
		} else {
			per = drawScene(false);
		}
		
		int* pos = camera_terrain_pick(1);
		if((int)pos!=0) {
			glPolygonMode(GL_FRONT_AND_BACK,GL_LINE);
			glEnable(GL_POLYGON_OFFSET_LINE);
			glPolygonOffset(0.0F,-500.0F);
			glDisable(GL_CULL_FACE);
			glLineWidth(1.0F);
			glBegin(GL_QUADS);
			glColor4f(1.0F,1.0F,1.0F,1.0F);
			glVertex3s(pos[0],pos[1],pos[2]);
			glVertex3s(pos[0]+1,pos[1],pos[2]);
			glVertex3s(pos[0]+1,pos[1],pos[2]+1);
			glVertex3s(pos[0],pos[1],pos[2]+1);
			
			glVertex3s(pos[0],pos[1]+1,pos[2]);
			glVertex3s(pos[0]+1,pos[1]+1,pos[2]);
			glVertex3s(pos[0]+1,pos[1]+1,pos[2]+1);
			glVertex3s(pos[0],pos[1]+1,pos[2]+1);
			
			glVertex3s(pos[0],pos[1],pos[2]);
			glVertex3s(pos[0]+1,pos[1],pos[2]);
			glVertex3s(pos[0]+1,pos[1]+1,pos[2]);
			glVertex3s(pos[0],pos[1]+1,pos[2]);
			
			glVertex3s(pos[0],pos[1],pos[2]+1);
			glVertex3s(pos[0]+1,pos[1],pos[2]+1);
			glVertex3s(pos[0]+1,pos[1]+1,pos[2]+1);
			glVertex3s(pos[0],pos[1]+1,pos[2]+1);
			glEnd();
			glEnable(GL_CULL_FACE);
			glPolygonOffset(0.0F,0.0F);
			glDisable(GL_POLYGON_OFFSET_LINE);
			glPolygonMode(GL_FRONT_AND_BACK,GL_FILL);
		}
	} else {
		per = (float)chunk_geometry_rebuild_state/(float)(CHUNKS_PER_DIM*CHUNKS_PER_DIM);
	}

	float time_delta = ((float)(timems()-time_last_frame))/1000.0F;
	time_last_frame = timems();
	float fps = (1.0F/time_delta);
	if(fps>fps_max) {
		fps_max = fps;
	}
	if(fps<fps_min) {
		fps_min = fps;
	}
	if(timems()-fps_last_update>500) {
		for(int k=0;k<99;k++) {
			fps_last[k] = fps_last[k+1];
			per_last[k] = per_last[k+1];
		}
		fps_last[99] = (fps_max+fps_min)/2.0F;
		per_last[99] = per;
		fps_max = 0;
		fps_min = 1000000;
		fps_last_update = timems();
	}

	if(settings.opengl14) {
		glDisable(GL_FOG);
	} else {
		glUniform1i(uniform_draw_ui, true);
	}
	
	/*glMatrixMode(GL_PROJECTION);
	glLoadIdentity();
	gluOrtho2D(-1.0F,1.0F,-1.0F,1.0F);
	glMatrixMode(GL_MODELVIEW);
	glLoadIdentity();
	
	glColor4f(1.0F,1.0F,0.0F,1.0F);
	glRasterPos2f(-1.0F,0.9F);
	
	char debug[32];
	//sprintf(debug,"%.2f%%",per*100.0F);
	
	for(int k=0;k<strlen(debug);k++) {
		glutBitmapCharacter(GLUT_BITMAP_HELVETICA_18,debug[k]);
	}
	
	glLineWidth(2.0F);
	glTranslatef(0.7F,0.7F,0.0F);
	glScalef(0.2F,0.2F,1.0F);
	glBegin(GL_LINES);
	float total_max = 0.0F;
	for(int k=0;k<100;k++) {
		if(fps_last[k]>total_max) {
			total_max = fps_last[k];
		}
	}
	for(int k=0;k<99;k++) {
		glColor4f(1.0F,0.0F,0.0F,1.0F);
		glVertex2f(-1.0F+2.0F*(k/100.0F),per_last[k]);
		glVertex2f(-1.0F+2.0F*((k+1)/100.0F),per_last[k+1]);
		glColor4f(1.0F,1.0F,0.0F,1.0F);
		glVertex2f(-1.0F+2.0F*(k/100.0F),fps_last[k]/total_max);
		glVertex2f(-1.0F+2.0F*((k+1)/100.0F),fps_last[k+1]/total_max);
	}
	glColor4f(1.0F,1.0F,1.0F,1.0F);
	glVertex2f(-1.0F,0.0F);
	glVertex2f(1.0F,0.0F);
	
	glVertex2f(-1.0F,1.1F);
	glVertex2f(1.0F,1.1F);
	
	glVertex2f(-1.0F,0.0F);
	glVertex2f(-1.0F,1.1F);
	
	glVertex2f(1.0F,0.0F);
	glVertex2f(1.0F,1.1F);
	glEnd();
	
	if(settings.opengl14) {
		glEnable(GL_FOG);
	} else {
		glUniform1i(uniform_draw_ui,false);
	}*/
	
	particle_update(time_delta);
	
	float x = 0.0F, y = 0.0F, z = 0.0F;

	if(key_map['w']) {
		x += sin(camera_rot_x)*sin(camera_rot_y);
		y += cos(camera_rot_y);
		z += cos(camera_rot_x)*sin(camera_rot_y);
	} else {
		if(key_map['s']) {
			x -= sin(camera_rot_x)*sin(camera_rot_y);
			y -= cos(camera_rot_y);
			z -= cos(camera_rot_x)*sin(camera_rot_y);
		}
	}
	
	if(key_map['a']) {
		x += sin(camera_rot_x+1.57);
		z += cos(camera_rot_x+1.57);
	} else {
		if(key_map['d']) {
			x += sin(camera_rot_x-1.57);
			z += cos(camera_rot_x-1.57);
		}
	}
	
	if(key_map['q']) {
		y++;
	} else {
		if(key_map['y']) {
			y--;
		}
	}
	
	float len = sqrt(x*x+y*y+z*z);
	if(len>0.0F) {
		camera_movement_x = (x/len)*camera_speed*time_delta;
		camera_movement_y = (y/len)*camera_speed*time_delta;
		camera_movement_z = (z/len)*camera_speed*time_delta;
	}
	
	if(abs(camera_movement_x)<1.0F) {
		camera_movement_x *= pow(0.0025F,time_delta);
	}
	if(abs(camera_movement_y)<1.0F) {
		camera_movement_y *= pow(0.0025F,time_delta);
	}
	if(abs(camera_movement_z)<1.0F) {
		camera_movement_z *= pow(0.0025F,time_delta);
	}
	
	aabb_set_center(&camera,camera_x+camera_movement_x,camera_y-camera_eye_height,camera_z);
	if(camera_x+camera_movement_x<0 || camera_x+camera_movement_x>map_size_x || aabb_intersection_terrain(&camera)) {
		camera_movement_x = 0.0F;
	}
	
	aabb_set_center(&camera,camera_x+camera_movement_x,camera_y+camera_movement_y-camera_eye_height,camera_z);
	if(camera_y+camera_movement_y<0 || camera_y+camera_movement_y>map_size_y || aabb_intersection_terrain(&camera)) {
		camera_movement_y = 0.0F;
	}
	
	aabb_set_center(&camera,camera_x+camera_movement_x,camera_y+camera_movement_y-camera_eye_height,camera_z+camera_movement_z);
	if(camera_z+camera_movement_z<0 || camera_z+camera_movement_z>map_size_z || aabb_intersection_terrain(&camera)) {
		camera_movement_z = 0.0F;
	}
	
	camera_x += camera_movement_x;
	camera_y += camera_movement_y;
	camera_z += camera_movement_z;

	if(key_map[27]) {
		exit(0);
	}


	#ifdef STANDALONE
		glutSwapBuffers();
		glutPostRedisplay();
	#endif
}

void init() {
	settings.opengl14 = true;
	settings.color_correction = false;
	settings.multisamples = 4;
	settings.shadow_entities = false;
	settings.ambient_occlusion = true;
	settings.render_distance = 128.0F;
	
	for(int k=0;k<128;k++) {
		overlay_textures_id[k] = 0;
		overlay_textures_data[k] = 0;
	}

	glDisable(GL_TEXTURE_RECTANGLE);

	glEnable(GL_DEPTH_TEST);
	glEnable(GL_CULL_FACE);
	glCullFace(GL_BACK);
	glFrontFace(GL_CCW);
	glHint(GL_PERSPECTIVE_CORRECTION_HINT,GL_NICEST);
	glClearDepth(1.0F);
	glDepthFunc(GL_LEQUAL);
	glShadeModel(GL_SMOOTH);
	
	particle_init();

	//tent = kv6_load(file_load("FullBody_Arms_3.kv6"));
	//gun = kv6_load(file_load("Rifle_10mm.kv6"));
	map_colors = malloc(map_size_x*map_size_y*map_size_z*8);
	for(int x=0;x<512;x++) { for(int z=0;z<512;z++) { for(int y=0;y<64;y++) {
		map_colors[x+(y*map_size_z+z)*map_size_x] = 0xFFFFFFFF;
	} } }
	//memset(map_colors,0x00000000FFFFFFFF,map_size_x*map_size_y*map_size_z);
	//map_vxl_load(file_load("lastsav.vxl"),map_colors);
	//genland(345423435,map_colors);
	if(!settings.opengl14) {
		texture_color_correction = genTexture(color_correction,16,16,16);
	}
	anim_start = timems();
	fps_last_update = anim_start;
}

void reshape(GLsizei width, GLsizei height) {
	glViewport(0,0,width,height);
	settings.window_width = width;
	settings.window_height = height;
}

#ifdef STANDALONE

void timer(int value) {
   //glutPostRedisplay();
   glutTimerFunc(1,timer,0);
}

void keys(unsigned char key, int x, int y) {
	key_map[key] = 1;
}

void keysUp(unsigned char key, int x, int y) {
	if(key=='o') {
		draw_outline = (~draw_outline)&0x01;
		chunk_set_render_mode(draw_outline);
	}
	if(key=='c') {
		particle_create(0x00FFFFFF,hj,hk,hl,5.0F,3.0F,64,0.1F,0.25F);
	}
	if(key=='v') {
		hj = camera_x;
		hk = camera_y;
		hl = camera_z;
	}
	if(key=='n') {
		settings.render_distance -= 10.0F;
	}
	if(key=='m') {
		settings.render_distance += 10.0F;
	}
	if(key=='f') {
		glutFullScreenToggle();
	}
	if(key=='p') {
		//printf("%f,%f,%f,%f,%f,5000,\n",camera_x,camera_y,camera_z,camera_rot_x,camera_rot_y);
	}
	if(key=='n' || key=='m') {
		//printf("Changed render distance to: %f blocks\n",settings.render_distance);
	}
	if(key=='e') {
		int* pos = camera_terrain_pick(2);
		if((int)pos!=0) {
			block_color = map_get(pos[0],pos[1],pos[2]);
		}
	}
	key_map[key] = 0;
}

void mouse_click(int button, int state, int x, int y) {
	if(button==GLUT_RIGHT_BUTTON && state==GLUT_DOWN) {
		int* pos = camera_terrain_pick(0);
		if((int)pos!=0 && pos[1]>1) {
			AABB camera;
			aabb_set_size(&camera,camera_size,camera_height,camera_size);
			aabb_set_center(&camera,camera_x,camera_y-camera_eye_height,camera_z);
			map_set(pos[0],pos[1],pos[2],block_color);
			if(aabb_intersection_terrain(&camera)) {
				map_set(pos[0],pos[1],pos[2],0xFFFFFFFF);
			}
		}
	}
	if(button==GLUT_LEFT_BUTTON && state==GLUT_DOWN) {
		int* pos = camera_terrain_pick(1);
		if((int)pos!=0 && pos[1]>1) {
			unsigned int col = map_get(pos[0],pos[1],pos[2]);
			map_set(pos[0],pos[1],pos[2],0xFFFFFFFF);
			particle_create(col,pos[0]+0.5F,pos[1]+0.5F,pos[2]+0.5F,2.5F,1.0F,16,0.1F,0.25F);
			if((map_get(pos[0],pos[1]+1,pos[2])&0xFFFFFFFF)!=0xFFFFFFFF && !map_ground_connected(pos[0],pos[1]+1,pos[2])) {
				map_apply_gravity();
			}
			if((map_get(pos[0],pos[1]-1,pos[2])&0xFFFFFFFF)!=0xFFFFFFFF && !map_ground_connected(pos[0],pos[1]-1,pos[2])) {
				map_apply_gravity();
			}
			if((map_get(pos[0]+1,pos[1],pos[2])&0xFFFFFFFF)!=0xFFFFFFFF && !map_ground_connected(pos[0]+1,pos[1],pos[2])) {
				map_apply_gravity();
			}
			if((map_get(pos[0]-1,pos[1],pos[2])&0xFFFFFFFF)!=0xFFFFFFFF && !map_ground_connected(pos[0]-1,pos[1],pos[2])) {
				map_apply_gravity();
			}
			if((map_get(pos[0],pos[1],pos[2]+1)&0xFFFFFFFF)!=0xFFFFFFFF && !map_ground_connected(pos[0],pos[1],pos[2]+1)) {
				map_apply_gravity();
			}
			if((map_get(pos[0],pos[1],pos[2]-1)&0xFFFFFFFF)!=0xFFFFFFFF && !map_ground_connected(pos[0],pos[1],pos[2]-1)) {
				map_apply_gravity();
			}
		}
	}
}

void mouse(int x, int y) {
    static unsigned char just_warped = 0;

    if(just_warped) {
        just_warped = 0;
        return;
    }

    int dx = x-settings.window_width/2;
    int dy = y-settings.window_height/2;

	if(dx!=0) {
		camera_rot_x -= dx*0.002F;
	}

	if(dy!=0) {
		camera_rot_y += dy*0.002F;
	}

	if(camera_rot_y<0.005F) {
		camera_rot_y = 0.005F;
	}
	if(camera_rot_y>3.14F) {
		camera_rot_y = 3.14F;
	}

	if(camera_rot_x>6.2832F) {
		camera_rot_x -= 6.2832F;
	}

	if(camera_rot_x<0.0F) {
		camera_rot_x += 6.2832F;
	}

	glutWarpPointer(settings.window_width/2,settings.window_height/2);
	just_warped = 1;
}

int main(int argc, char** argv) {
	settings.opengl14 = false;
	settings.color_correction = true;
	settings.multisamples = 4;
	settings.shadow_entities = false;
	settings.ambient_occlusion = false;
	settings.render_distance = 128.0F;
	settings.window_width = 800;
	settings.window_height = 600;
	
	if(argc>2) {
		settings.opengl14 = atoi(argv[1]);
		settings.color_correction = atoi(argv[2]);
		settings.multisamples = atoi(argv[3]);
		settings.shadow_entities = atoi(argv[4]);
		settings.ambient_occlusion = atoi(argv[5]);
	}

	glutInit(&argc,argv);
	//glutInitDisplayString("rgb double depth>=24 samples>=2");
	if(settings.multisamples>0) {
		glutSetOption(GLUT_MULTISAMPLE,settings.multisamples);
		glutInitDisplayMode(GLUT_DOUBLE | GLUT_RGB | GLUT_DEPTH | GLUT_MULTISAMPLE | (GLUT_STENCIL*settings.shadow_entities));
	} else {
		glutInitDisplayMode(GLUT_DOUBLE | GLUT_RGB | GLUT_DEPTH | (GLUT_STENCIL*settings.shadow_entities));
	}
	glutInitWindowSize(settings.window_width,settings.window_height);
	glutInitWindowPosition((glutGet(GLUT_SCREEN_WIDTH)-glutGet(GLUT_INIT_WINDOW_WIDTH))/2,(glutGet(GLUT_SCREEN_HEIGHT)-glutGet(GLUT_INIT_WINDOW_HEIGHT))/2);
	glutCreateWindow("VoxelWar");
	glutDisplayFunc(display);
	glutReshapeFunc(reshape);
	glutKeyboardFunc(keys);
	glutKeyboardUpFunc(keysUp);
	glutMotionFunc(mouse);
	glutPassiveMotionFunc(mouse);
	glutMouseFunc(mouse_click);
	glutTimerFunc(0,timer,0);
	glutSetCursor(GLUT_CURSOR_NONE);

	#ifdef OS_WINDOWS
		glPointParameterfv = (PFNGLPOINTPARAMETERFVPROC)wglGetProcAddress("glPointParameterfv");
	#endif
	#ifdef OS_LINUX
		glPointParameterfv = (PFNGLPOINTPARAMETERFVPROC)glXGetProcAddress("glPointParameterfv");
	#endif
	
	if(!settings.opengl14) {
		#ifdef OS_WINDOWS
			glCreateShader = (PFNGLCREATESHADERPROC)wglGetProcAddress("glCreateShader");
			glShaderSource = (PFNGLSHADERSOURCEPROC)wglGetProcAddress("glShaderSource");
			glCompileShader = (PFNGLCOMPILESHADERPROC)wglGetProcAddress("glCompileShader");
			glCreateProgram = (PFNGLCREATEPROGRAMPROC)wglGetProcAddress("glCreateProgram");
			glAttachShader = (PFNGLATTACHSHADERPROC)wglGetProcAddress("glAttachShader");
			glLinkProgram = (PFNGLLINKPROGRAMPROC)wglGetProcAddress("glLinkProgram");
			glUseProgram = (PFNGLUSEPROGRAMPROC)wglGetProcAddress("glUseProgram");
			glGetUniformLocation = (PFNGLGETUNIFORMLOCATIONPROC)wglGetProcAddress("glGetUniformLocation");
			glUniform1f = (PFNGLUNIFORM1FPROC)wglGetProcAddress("glUniform1f");
			glUniform4f = (PFNGLUNIFORM4FPROC)wglGetProcAddress("glUniform4f");
			glUniform1i = (PFNGLUNIFORM1IPROC)wglGetProcAddress("glUniform1i");
			glTexImage3D = (PFNGLTEXIMAGE3DPROC)wglGetProcAddress("glTexImage3D");
		#endif
		#ifdef OS_LINUX
			glCreateShader = (PFNGLCREATESHADERPROC)glXGetProcAddress("glCreateShader");
			glShaderSource = (PFNGLSHADERSOURCEPROC)glXGetProcAddress("glShaderSource");
			glCompileShader = (PFNGLCOMPILESHADERPROC)glXGetProcAddress("glCompileShader");
			glCreateProgram = (PFNGLCREATEPROGRAMPROC)glXGetProcAddress("glCreateProgram");
			glAttachShader = (PFNGLATTACHSHADERPROC)glXGetProcAddress("glAttachShader");
			glLinkProgram = (PFNGLLINKPROGRAMPROC)glXGetProcAddress("glLinkProgram");
			glUseProgram = (PFNGLUSEPROGRAMPROC)glXGetProcAddress("glUseProgram");
			glGetUniformLocation = (PFNGLGETUNIFORMLOCATIONPROC)glXGetProcAddress("glGetUniformLocation");
			glUniform1f = (PFNGLUNIFORM1FPROC)glXGetProcAddress("glUniform1f");
			glUniform4f = (PFNGLUNIFORM4FPROC)glXGetProcAddress("glUniform4f");
			glUniform1i = (PFNGLUNIFORM1IPROC)glXGetProcAddress("glUniform1i");
			glTexImage3D = (PFNGLTEXIMAGE3DPROC)glXGetProcAddress("glTexImage3D");
		#endif

		int shadera = glCreateShader(GL_VERTEX_SHADER);
		unsigned char* vertex = file_load("vertex.shader");
		unsigned char* fragment = file_load("fragment.shader");
		
		glShaderSource(shadera,1,(const GLchar* const*)&vertex,NULL);
		glCompileShader(shadera);

		int shaderb = glCreateShader(GL_FRAGMENT_SHADER);
		glShaderSource(shaderb,1,(const GLchar* const*)&fragment,NULL);
		glCompileShader(shaderb);

		int program = glCreateProgram();
		glAttachShader(program,shadera);
		glAttachShader(program,shaderb);
		glLinkProgram(program);
		glUseProgram(program);
		uniform_point_size = glGetUniformLocation(program,"point_size");
		uniform_near_plane_height = glGetUniformLocation(program,"near_plane_height");
		uniform_camera_x = glGetUniformLocation(program,"camera_x");
		uniform_camera_z = glGetUniformLocation(program,"camera_z");
		uniform_fog_distance = glGetUniformLocation(program,"fog_distance");
		uniform_map_size_x = glGetUniformLocation(program,"max_size_x");
		uniform_map_size_z = glGetUniformLocation(program,"max_size_z");
		uniform_fog_color = glGetUniformLocation(program,"fog_color");
		uniform_setting_color_correction = glGetUniformLocation(program,"setting_color_correction");
		uniform_draw_ui = glGetUniformLocation(program,"draw_ui");

		glEnable(GL_VERTEX_PROGRAM_POINT_SIZE);
	}

	glutWarpPointer(settings.window_width/2,settings.window_height/2);
	last_mouse_x = settings.window_width/2;
	last_mouse_y = settings.window_height/2;
	
	init();

	if(settings.multisamples>0) {
		glEnable(GL_MULTISAMPLE);
		glHint(GL_MULTISAMPLE_FILTER_HINT_NV,GL_NICEST);
		int iMultiSample = 0;
		int iNumSamples = 0;
		glGetIntegerv(GL_SAMPLE_BUFFERS,&iMultiSample);
		glGetIntegerv(GL_SAMPLES,&iNumSamples);
		//printf("MSAA on, GL_SAMPLE_BUFFERS = %d, GL_SAMPLES = %d\n", iMultiSample, iNumSamples);
	}
	
	glutMainLoop();
}

#endif